<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loan / EMI Calculator Pro</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Montserrat',sans-serif}
    body{
      background:linear-gradient(to right,#74ABE2,#5563DE);
      display:flex;flex-direction:column;align-items:center;min-height:100vh;
      padding:20px;color:#fff;
    }
    .container{
      background:rgba(255,255,255,0.15);padding:30px;border-radius:10px;
      width:100%;max-width:960px;text-align:center;
    }
    h1{margin-bottom:10px}
    .row{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin:10px 0}
    input,select,button{
      padding:10px;border:none;border-radius:6px;font-size:14px;width:100%;
    }
    button{background:#ff7b54;color:#fff;cursor:pointer}
    button:hover{background:#ff5722}
    .summary{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
    .card{background:rgba(255,255,255,.95);color:#000;border-radius:8px;padding:12px}
    .card h3{font-size:13px;color:#444;margin-bottom:6px}
    .card p{font-weight:700;font-size:18px}
    table{width:100%;border-collapse:collapse;margin-top:15px;background:#fff;color:#000;border-radius:8px;overflow:hidden}
    th,td{border:1px solid #e9e9e9;padding:8px;text-align:right}
    th{text-align:center;background:#f7f7f7}
    .actions{margin-top:12px;display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
    .muted{opacity:.9;font-size:12px;margin-top:6px}
    footer{margin-top:18px;color:#fff;font-size:16px;text-align:center}
    footer strong{color:#ffdd57}
    /* PDF area visual isolation (not necessary, but helps ensure clean export) */
    #report{background:#fff;color:#000;padding:20px;border-radius:10px;margin-top:16px}
    #report h2{margin-bottom:8px}
    .hidden{display:none !important}
  </style>
</head>
<body>

  <div class="container">
    <h1>Loan / EMI Calculator Pro</h1>

    <div class="row">
      <input id="amount" type="number" placeholder="Loan Amount" />
      <input id="rate" type="number" step="0.01" placeholder="Annual Interest %"/>
      <input id="tenure" type="number" placeholder="Tenure"/>
      <select id="tenureType">
        <option value="months">Months</option>
        <option value="years">Years</option>
      </select>
      <select id="currency">
        <option value="$">$ (USD)</option>
        <option value="₹" selected>₹ (INR)</option>
        <option value="€">€ (EUR)</option>
        <option value="£">£ (GBP)</option>
      </select>
    </div>

    <div class="actions">
      <button id="calcBtn">Calculate</button>
      <button id="downloadCSV">Download CSV</button>
      <button id="downloadPDF">Download PDF</button>
    </div>

    <!-- Summary cards -->
    <div class="summary hidden" id="summaryCards">
      <div class="card"><h3>Monthly EMI</h3><p id="emiOut">0</p></div>
      <div class="card"><h3>Total Interest</h3><p id="intOut">0</p></div>
      <div class="card"><h3>Total Payment</h3><p id="totOut">0</p></div>
    </div>

    <!-- Report area (used for PDF export too) -->
    <div id="report" class="hidden">
      <h2 style="text-align:center">Amortization Schedule</h2>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-bottom:12px">
        <div><strong>Amount:</strong> <span id="rAmt"></span></div>
        <div><strong>Rate:</strong> <span id="rRate"></span></div>
        <div><strong>Tenure:</strong> <span id="rTen"></span></div>
      </div>

      <table id="schedule">
        <thead>
          <tr><th>Month</th><th>EMI</th><th>Interest</th><th>Principal</th><th>Balance</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <p class="muted">Tip: Choose tenure in <em>years</em> for long loans. Rate 0% is supported.</p>
  </div>

  <footer>
    Developed by <strong>Karthik Shet</strong>
  </footer>

  <!-- html2pdf for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"
          integrity="sha512-YcsIPj9Qm0W1n8U1fQz9o8r6N4Cr7mWm0oI2eP5q1JQ3m0J9p3bM1Qm1m8Nf3vZy4jH9u6QpW3Ew9zG7x0Pjig=="
          crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const el = (id) => document.getElementById(id);
    const amtEl = el('amount'), rateEl = el('rate'), tenEl = el('tenure'), typeEl = el('tenureType'), curEl = el('currency');
    const summary = el('summaryCards'), tbody = el('schedule').querySelector('tbody');
    const emiOut = el('emiOut'), intOut = el('intOut'), totOut = el('totOut');
    const report = el('report');

    function fmt(n, c) {
      return c + ' ' + Number(n).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function calc() {
      const P = parseFloat(amtEl.value);
      const annual = parseFloat(rateEl.value);         // % p.a.
      let n = parseInt(tenEl.value, 10);
      const c = curEl.value;

      if (!P || P <= 0 || !n || n <= 0 || isNaN(annual)) {
        alert('Please enter valid Amount, Rate and Tenure.');
        return;
      }
      if (typeEl.value === 'years') n *= 12;

      const r = (annual / 12 / 100); // monthly rate
      let EMI, totalInterest = 0, balance = P;

      tbody.innerHTML = '';

      if (r === 0) {
        // Zero-interest edge case
        EMI = P / n;
        for (let m = 1; m <= n; m++) {
          const interest = 0;
          const principal = EMI;
          balance = Math.max(0, balance - principal);
          addRow(m, EMI, interest, principal, balance, c);
        }
        totalInterest = 0;
      } else {
        EMI = P * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
        for (let m = 1; m <= n; m++) {
          const interest = balance * r;
          const principal = EMI - interest;
          balance = Math.max(0, balance - principal);
          totalInterest += interest;
          addRow(m, EMI, interest, principal, balance, c);
        }
      }

      // Summary
      emiOut.textContent = fmt(EMI, c);
      intOut.textContent = fmt(totalInterest, c);
      totOut.textContent = fmt(P + totalInterest, c);
      summary.classList.remove('hidden');

      // Report header values for PDF
      el('rAmt').textContent = fmt(P, c);
      el('rRate').textContent = annual.toFixed(2) + '% p.a.';
      el('rTen').textContent = n + ' months';
      report.classList.remove('hidden');
    }

    function addRow(month, emi, interest, principal, balance, c) {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align:center">${month}</td>
        <td>${fmt(emi, c)}</td>
        <td>${fmt(interest, c)}</td>
        <td>${fmt(principal, c)}</td>
        <td>${fmt(balance, c)}</td>
      `;
      tbody.appendChild(tr);
    }

    function downloadCSV() {
      if (tbody.children.length === 0) return alert('Calculate first.');
      const c = curEl.value;
      let csv = 'Month,EMI,Interest,Principal,Balance\n';
      [...tbody.children].forEach(tr => {
        const cells = [...tr.children].map(td => td.textContent.replace(/[^\d.-]/g, ''));
        csv += cells.join(',') + '\n';
      });
      const blob = new Blob([csv], { type: 'text/csv' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'amortization_schedule.csv';
      a.click();
    }

    function downloadPDF() {
      if (tbody.children.length === 0) return alert('Calculate first.');
      // Use the report area only for a clean PDF
      const node = report.cloneNode(true);
      node.style.margin = '0';
      html2pdf().set({
        filename: 'EMI_Report.pdf',
        margin: 10,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).from(node).save();
    }

    el('calcBtn').addEventListener('click', calc);
    el('downloadCSV').addEventListener('click', downloadCSV);
    el('downloadPDF').addEventListener('click', downloadPDF);
  </script>
</body>
</html>
